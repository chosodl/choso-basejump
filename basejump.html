<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BaseJUMP Mini-Game</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 1. Farcaster Embed Metadata (Bdel b l-liens dyalk) -->
    <meta name="fc:miniapp" content='{
      "version":"next",
      "imageUrl":"https://example.com/dune-jumper/dune-jumper-embed.png", 
      "button":{
          "title":"Play BaseJUMP!",
          "action":{
          "type":"launch_miniapp",
          "name":"BaseJUMP",
          "url":"https://example.com/dune-jumper" 
          }
      },
      "castShareUrl": "https://example.com/dune-jumper", 
      "ogTitle": "BaseJUMP Mini-App", 
      "ogDescription": "Jump over the spikes in this addictive mini-game!", 
      "ogImageUrl": "https://example.com/dune-jumper/dune-jumper-embed.png" 
    }' />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #EDECEB; /* Light sand/off-white background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
            overflow: hidden; 
        }
        #app-container {
            width: 90%;
            max-width: 900px;
            background-color: #6a95f0; 
            border: 3px solid #0044AA; /* Darker border for a cool blue look */
            border-radius: 16px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 70vh; /* Increased relative height for better play area */
            min-height: 350px;
            max-height: 700px;
            position: relative; /* Mouhim l-positioning dial l-canvas */
        }
        
        /* New: Canvas as the background layer */
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; 
            display: block;
            border-radius: 13px; /* Nkhaliwh chwia sghir 3la l-container */
            cursor: default; /* No pointer on the background */
        }

        /* Style for the two main views - overlay the canvas */
        #game-container, #landing-page {
            position: absolute;
            top: 10px; /* 10px padding dial app-container */
            left: 10px;
            z-index: 10; /* Above canvas */
            
            display: none; /* Hidden by default, shown by JS */
            width: calc(100% - 20px); /* L-width dial l-inner area */
            height: calc(100% - 20px); /* L-height dial l-inner area */
            flex-direction: column;
            align-items: center;
        }
        
        /* Override for landing page to fit in its place */
        #landing-page {
            justify-content: center;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.2); /* Chwiya dial dark overlay bach yban l-ktaba */
            border-radius: 12px;
            padding: 20px;
        }

        #ui-bar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            font-size: 1.2rem;
            font-weight: 700;
            color: #FFF; 
            background-color: #0044AA; 
            border-bottom: 1px solid #ddd;
            border-radius: 12px 12px 0 0;
        }
        #controls {
            padding: 10px 0 5px;
            font-size: 0.9rem;
            color: #FFF; /* White color for controls on blue background */
            text-align: center;
        }
        
        /* ... rest of CSS ... (No major changes here) */

        .connect-btn {
            background-color: #00FF99; /* Green/Neon for action */
            color: #0044AA;
            font-weight: 700;
            border: none;
            padding: 15px 35px;
            text-align: center;
            display: inline-block;
            font-size: 20px;
            cursor: pointer;
            border-radius: 10px;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 6px 0 #00AA66;
        }
        .connect-btn:hover:not(:disabled) {
            background-color: #00AA66;
            color: #FFF;
        }
        .connect-btn:active:not(:disabled) {
            transform: translateY(3px);
            box-shadow: 0 3px 0 #00AA66;
        }
        
        .message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            padding: 30px 40px;
            border: 4px solid #0044AA;
            border-radius: 12px;
            text-align: center;
            z-index: 10;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            min-width: 280px;
        }
        .message-box h2 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #0044AA; /* أزرق غامق */
        }
        .message-box button {
            background-color: #007BFF; /* أزرق فاتح للزر */
            color: white;
            border: none;
            padding: 12px 25px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 18px;
            margin-top: 20px;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px 0 #0056b3;
        }
        .message-box button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        .message-box button:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #0056b3;
        }
         .message-box button:disabled {
            background-color: #999;
            box-shadow: 0 4px 0 #666;
            cursor: not-allowed;
         }
         /* Status message (mn l-code l-khor) */
         #payment-status {
            margin-top: 15px;
            font-size: 14px;
            font-weight: 600;
            padding: 10px;
            border-radius: 8px;
            display: none; /* Hidden by default */
         }
         #payment-status.error {
             background-color: #f8d7da;
             color: #721c24;
             display: block;
         }
         #payment-status.success {
             background-color: #d4edda;
             color: #155724;
             display: block;
         }
         #payment-status.loading {
             background-color: #cce5ff;
             color: #004085;
             display: block;
         }
    </style>
</head>
<body>

<div id="app-container">

    <!-- Canvas for the Game/Background (Now the permanent background) -->
    <canvas id="gameCanvas"></canvas>

    <!-- 1. Landing Page / Connect Wallet UI (Overlay View) -->
    <div id="landing-page" style="display: flex;">
        <div class="flex flex-col items-center justify-center w-full h-full p-8">
            <h1 class="text-white text-6xl md:text-8xl">BaseJUMP</h1>
            <p class="text-white text-lg md:text-2xl mt-4 mb-10">Connect your wallet to start playing!</p>
            
            <button id="connect-wallet-btn" class="connect-btn">
                Connect Wallet
            </button>

            <!-- Status for Wallet Connection -->
            <div id="wallet-status" class="mt-4 p-3 font-semibold rounded-lg text-sm" style="display: none;"></div>

            <!-- Display Connected Address -->
             <div id="connected-address" class="mt-4 p-2 bg-white/20 text-white rounded-lg text-sm font-mono" style="display: none;"></div>

        </div>
    </div>


    <!-- 2. Game UI (Overlay View - Hidden until connected) -->
    <div id="game-container">
        <!-- UI Bar for Scores -->
        <div id="ui-bar">
            <span id="score-display">Score: 0</span>
            <span id="best-display">Best: 0</span>
        </div>

        <!-- The Canvas is outside now, the rest is the game UI -->

        <!-- Controls Hint -->
        <div id="controls">
            Space / **Double Tap / Double Click** to jump
        </div>

        <!-- Game Over/Start Message Box (Initially Visible when game-container is shown) -->
        <div id="message-container" style="display: flex;">
            <div class="message-box">
                <h2 id="message-title">BaseJUMP</h2>
                <p id="message-score" class="text-xl mt-4">Pay a small fee to play!</p>
                <div id="payment-status"></div> <!-- ZNA HADI L-STATUS -->
                <button id="restart-button">Pay & Play</button>
            </div>
        </div>
    </div>
</div>

<script type="module"> // <-- BDIL: TYPE="MODULE"

    // ========= 1. Import SDK & Call Ready (XO Pro Style) =========
    import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk';
    sdk.actions.ready();
    console.log("Farcaster SDK ready() called immediately.");

    // ========= 2. Farcaster/Wallet Config & Global State =========
    const GAME_FEE_ETH = '0.00001'; 
    const DEVELOPER_WALLET = '0x5174542B8964c2975949540b6140d7c76B76A03f'; // <--- BDDL HADI B L'ADRESSE DYALK! (Temporary Placeholder)
    const TARGET_CHAIN_ID = '0x2105'; // Base Mainnet
    
    let isWalletConnected = false; // New global state for connection

    // ========= 3. Farcaster/Wallet Helpers (XO Pro Style) =========
    function parseEther(x){ 
        const [w,f=""] = String(x).split('.'); 
        const frac=(f+'0'.repeat(18)).slice(0,18); 
        return '0x'+(BigInt(w)*10n**18n + BigInt(frac)).toString(16); 
    }
    
    async function getProvider(){ 
        try{ 
            const p = await sdk.wallet.getEthereumProvider(); 
            if (p) return p; 
        } catch(e) { console.warn("Farcaster provider error", e); } 
        return window.ethereum ?? null; 
    }
    
    async function ensureChain(provider, chainId){
        const current = (await provider.request({method:'eth_chainId'}))?.toLowerCase();
        if(current === chainId.toLowerCase()) return;
        try { 
            await provider.request({method:'wallet_switchEthereumChain', params:[{chainId}]}); 
        } catch(e) {
            if(e?.code === 4902) { 
                 throw new Error("Wrong network. Please switch to Base.");
            } else { 
                throw e; 
            }
        }
    }

    // --- UI Status Handlers (Updated for Wallet and Payment) ---
    const walletStatusEl = document.getElementById('wallet-status');
    const paymentStatusEl = document.getElementById('payment-status');
    const connectedAddressEl = document.getElementById('connected-address');

    const setWalletStatus = (msg, type = 'loading') => {
        walletStatusEl.textContent = msg;
        walletStatusEl.className = `mt-4 p-3 font-semibold rounded-lg text-sm bg-white/10 ${type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-blue-200'}`;
        walletStatusEl.style.display = 'block';
    }
    
    const setPaymentStatus = (msg, type = 'loading') => {
        paymentStatusEl.textContent = msg;
        paymentStatusEl.className = type; // 'loading', 'success', 'error'
    }
    
    const hideAllStatuses = () => {
        walletStatusEl.style.display = 'none';
        paymentStatusEl.style.display = 'none';
        connectedAddressEl.style.display = 'none';
    }

    // --- View Controllers ---
    const landingPage = document.getElementById('landing-page');
    const gameContainer = document.getElementById('game-container');

    function showLanding() {
        landingPage.style.display = 'flex';
        gameContainer.style.display = 'none';
        drawStaticLandingScene(); // Re-draw static background
    }

    function showGame() {
        landingPage.style.display = 'none';
        gameContainer.style.display = 'flex';
        // Re-draw/resize when showing game for the first time
        resizeCanvas();
    }
    
    // --- Wallet Connection Logic ---
    async function connectWallet(triggerBtn){
        let provider, accounts;
        try{ 
            if (triggerBtn) triggerBtn.disabled = true;
            setWalletStatus('Locating wallet...', 'loading');
            
            provider = await getProvider();
            if(!provider){ 
                setWalletStatus('No wallet found. Please use the app inside Farcaster.', 'error'); 
                throw new Error('NO_PROVIDER'); 
            }
            
            setWalletStatus('Requesting account access...', 'loading');
            // Request accounts to establish connection
            accounts = await provider.request({ method:'eth_requestAccounts' });
            const from = accounts?.[0];

            if(!from){
                setWalletStatus('Wallet connection denied.', 'error');
                throw new Error('Connection Denied');
            }

            setWalletStatus('Switching to Base...', 'loading');
            await ensureChain(provider, TARGET_CHAIN_ID);
            
            // Success
            isWalletConnected = true;
            connectedAddressEl.textContent = `Connected: ${from.slice(0, 6)}...${from.slice(-4)}`;
            connectedAddressEl.style.display = 'block';
            setWalletStatus('Wallet connected!', 'success');
            
            // Switch to game view after a small delay
            setTimeout(() => {
                 showGame();
                 hideAllStatuses();
            }, 500);

        }
        catch(e){ 
            console.error('Wallet connection error:', e); 
            setWalletStatus(e.message || 'Connection failed.', 'error');
            drawStaticLandingScene(); // Ensure static scene is drawn on error
        }
        finally{ 
            if (triggerBtn) triggerBtn.disabled = false;
        }
    }

    // --- Payment Transaction Logic (Modified) ---
    async function requiredPaymentTransaction(){
        setPaymentStatus('1/3: Getting account...', 'loading');
        const provider = await getProvider();
        if(!provider){ setPaymentStatus('Wallet lost. Please refresh.', 'error'); throw new Error('NO_PROVIDER'); }
        
        const [from] = await provider.request({ method:'eth_accounts' });
        if (!from) { setPaymentStatus('Not connected. Re-run connection.', 'error'); throw new Error('NO_ACCOUNT'); }
        
        setPaymentStatus('2/3: Checking network...', 'loading');
        await ensureChain(provider, TARGET_CHAIN_ID);
        
        setPaymentStatus('3/3: Sending payment...', 'loading');
        const hash = await provider.request({
            method:'eth_sendTransaction',
            params:[{ from, to: DEVELOPER_WALLET, value: parseEther(GAME_FEE_ETH) }]
        });
        
        setPaymentStatus('✅ Payment complete!', 'success');
        return hash;
    }

    async function payThen(action, triggerBtn){
        try{ 
            triggerBtn.disabled = true; 
            await requiredPaymentTransaction(); 
            setTimeout(() => { 
                 action(); // Call l action (resetGame)
                 paymentStatusEl.style.display = 'none'; // Nkhbiw status message
            }, 1000);
        }
        catch(e){ 
            console.error('Payment gate error:', e); 
            setPaymentStatus(e.message, 'error');
        }
        finally{ 
            triggerBtn.disabled = false; 
        }
    }

    // ========= 4. Game Code (Mabdelch bzaf) =========

    // --- Global Game Variables ---
    const appContainer = document.getElementById('app-container'); // Need this for sizing
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreDisplay = document.getElementById('score-display');
    const bestDisplay = document.getElementById('best-display');
    const messageContainer = document.getElementById('message-container');
    const connectButton = document.getElementById('connect-wallet-btn');
    const restartButton = document.getElementById('restart-button');
    
    // Game State
    let game = {
        isRunning: false,
        isGameOver: true,
        score: 0,
        highScore: 0,
        initialSpeed: 2.5,
        speed: 2.5, 
        gravity: 0.65,
        groundY: 0, 
        lastObstacleTime: 0,
        initialObstacleInterval: 1800,
        obstacleInterval: 1800, 
        difficultyIncreaseRate: 0.00035,
        lastBirdTime: 0, 
        birdInterval: 2500 
    };

    let player;
    let obstacles = [];
    let birds = []; 
    let animationFrameId;
    
    let lastClickTime = 0;
    const DOUBLE_CLICK_TIME = 300; 

    // ... (Kolchi l colors kima kano) ...
    const BACKGROUND_COLOR_START = '#007FFF'; 
    const BACKGROUND_COLOR_END = '#0044AA';   
    const GROUND_COLOR = '#4477AA';           
    const OBSTACLE_COLOR = '#000000';         
    const BIRD_COLOR = '#000000';             
    const BALL_FILL_COLOR = '#FFFFFF';      
    const CUTOUT_COLOR = '#0052FF';           

    // --- Utility Functions ---
    function loadHighScore() { 
        const storedScore = localStorage.getItem('duneJumperHighScore');
        game.highScore = storedScore ? parseInt(storedScore, 10) : 0;
        bestDisplay.textContent = `Best: ${game.highScore}`;
    }
    function saveHighScore() { 
        localStorage.setItem('duneJumperHighScore', game.highScore);
    }

    // --- Game Entities (No change) ---
    class Player { 
        constructor(x, y, size) { this.initialX = x; this.initialY = y; this.size = size; this.reset(); }
        reset() { this.x = this.initialX; this.y = this.initialY; this.yVelocity = 0; this.isJumping = false; }
        jump() { if (!this.isJumping) { this.isJumping = true; this.yVelocity = -14; } }
        update() { this.yVelocity += game.gravity; this.y += this.yVelocity; if (this.y + this.size > game.groundY) { this.y = game.groundY - this.size; this.yVelocity = 0; this.isJumping = false; } }
        draw() { const cX = this.x + this.size / 2; const cY = this.y + this.size / 2; const r = this.size / 2; ctx.save(); ctx.shadowColor = 'rgba(0, 0, 0, 0.5)'; ctx.shadowBlur = 4; ctx.shadowOffsetX = 2; ctx.shadowOffsetY = 2; ctx.fillStyle = BALL_FILL_COLOR; ctx.beginPath(); ctx.arc(cX, cY, r, 0, Math.PI * 2); ctx.fill(); ctx.fillStyle = BACKGROUND_COLOR_END; const cw = r * 1.2; const ch = r * 0.4; ctx.fillRect(cX - r - (cw * 0.2), cY - ch / 2, cw, ch); ctx.restore(); }
        getBounds() { return { x: this.x, y: this.y, width: this.size, height: this.size }; }
    }
    class Obstacle { 
        constructor() { this.width = Math.random() * 20 + 20; this.height = Math.random() * 25 + 30; this.x = canvas.width; this.y = game.groundY - this.height; }
        update() { this.x -= game.speed; }
        draw() { ctx.fillStyle = OBSTACLE_COLOR; ctx.shadowColor = 'rgba(0, 0, 0, 0.7)'; ctx.shadowBlur = 6; ctx.shadowOffsetX = 3; ctx.shadowOffsetY = 3; ctx.beginPath(); ctx.moveTo(this.x, game.groundY); ctx.lineTo(this.x + this.width / 2, this.y); ctx.lineTo(this.x + this.width, game.groundY); ctx.closePath(); ctx.fill(); ctx.shadowColor = 'transparent'; ctx.shadowBlur = 0; ctx.shadowOffsetX = 0; ctx.shadowOffsetY = 0; }
        getBounds() { return { x: this.x, y: this.y, width: this.width, height: this.height }; }
    }
    class Bird { 
        constructor() { this.x = canvas.width; this.y = Math.random() * (canvas.height * 0.3) + 10; this.size = Math.random() * 6 + 8; this.speedFactor = 0.5 + Math.random() * 0.2; }
        update() { this.x -= game.speed * this.speedFactor; }
        draw() { ctx.fillStyle = BIRD_COLOR; ctx.strokeStyle = BIRD_COLOR; const s = this.size, x = this.x, y = this.y; ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x + s / 2, y + s / 2); ctx.lineTo(x + s, y); ctx.lineTo(x + s * 1.5, y + s / 2); ctx.lineTo(x + s * 2, y); ctx.lineWidth = 1.5; ctx.stroke(); }
    }

    // --- Core Game Logic ---
    function resetGame() { 
        game.isRunning = true;
        game.isGameOver = false;
        game.score = 0;
        game.speed = game.initialSpeed;
        game.obstacleInterval = game.initialObstacleInterval;
        game.lastObstacleTime = performance.now();
        game.lastBirdTime = performance.now(); 
        obstacles = [];
        birds = []; 
        player.reset();
        messageContainer.style.display = 'none';
        
        if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
        }
        gameLoop(0); 
    }
    function spawnObstacle(time) { 
        const r = 0.8 + Math.random() * 0.4; if (time - game.lastObstacleTime > game.obstacleInterval * r) { obstacles.push(new Obstacle()); game.lastObstacleTime = time; }
    }
    function spawnBird(time) { 
        const r = 0.7 + Math.random() * 0.6; if (time - game.lastBirdTime > game.birdInterval * r) { birds.push(new Bird()); game.lastBirdTime = time; }
    }
    function checkCollision() { 
        const pRect = player.getBounds();
        for (let i = 0; i < obstacles.length; i++) { const oRect = obstacles[i].getBounds(); if (pRect.x < oRect.x + oRect.width && pRect.x + pRect.width > oRect.x && pRect.y < oRect.y + oRect.height && pRect.y + pRect.height > oRect.y) { gameOver(); return true; } } return false;
    }
    
    function gameOver() {
        game.isRunning = false;
        game.isGameOver = true;
        cancelAnimationFrame(animationFrameId);
        
        const finalScore = Math.floor(game.score / 10);
        if (finalScore > game.highScore) {
            game.highScore = finalScore;
            saveHighScore();
            bestDisplay.textContent = `Best: ${game.highScore}`;
            document.getElementById('message-title').textContent = 'NEW HIGH SCORE!';
        } else {
            document.getElementById('message-title').textContent = 'Game Over';
        }

        document.getElementById('message-score').textContent = `Your Score: ${finalScore}`;
        restartButton.textContent = 'Pay & Play Again'; 
        messageContainer.style.display = 'flex';
    }

    function updateScore() { 
        game.score += 1; scoreDisplay.textContent = `Score: ${Math.floor(game.score / 10)}`; game.speed += game.difficultyIncreaseRate; game.obstacleInterval = Math.max(800, game.obstacleInterval - 0.5); 
    }

    // --- Main Loop and Drawing ---
    function drawBackground() { 
        const g = ctx.createLinearGradient(0, 0, 0, canvas.height); g.addColorStop(0, BACKGROUND_COLOR_START); g.addColorStop(1, BACKGROUND_COLOR_END); ctx.fillStyle = g; ctx.fillRect(0, 0, canvas.width, canvas.height); 
    }
    function drawGround() { 
        ctx.fillStyle = GROUND_COLOR; ctx.fillRect(0, game.groundY, canvas.width, canvas.height - game.groundY); ctx.strokeStyle = '#333'; ctx.lineWidth = 1; ctx.beginPath(); ctx.moveTo(0, game.groundY); ctx.lineTo(canvas.width, game.groundY); ctx.stroke();
    }
    
    // New function to draw only the static background/ground
    function drawStaticLandingScene() {
        drawBackground();
        drawGround();
    }
    
    function gameLoop(time) { 
        if (!game.isRunning) return;
        drawBackground();
        spawnBird(time); birds = birds.filter(b => { b.update(); b.draw(); return b.x + b.size * 2 > 0; });
        drawGround();
        player.update(); player.draw();
        spawnObstacle(time); obstacles = obstacles.filter(o => { o.update(); o.draw(); return o.x + o.width > 0; });
        checkCollision();
        updateScore();
        animationFrameId = requestAnimationFrame(gameLoop);
    }
    
    // --- Event Listeners and Initialization ---
    function resizeCanvas() { 
        // L-canvas dyalna dima tayakhod l-hجم dial app-container
        const c = appContainer;
        canvas.width = c.clientWidth - 20; 
        canvas.height = c.clientHeight - 20; 
        game.groundY = canvas.height * 0.9;
        
        if (!player) { 
            player = new Player(30, game.groundY - 30, 30); 
        } else { 
            player.initialY = game.groundY - player.size; 
        }

        if (game.isRunning) {
            // Nothing needed here, gameLoop will handle it
        } else {
             // Koulma tbeddel size, n3awdo ndirou draw l-static scene
             drawStaticLandingScene();
             if (game.isGameOver) {
                 // Ghandirou draw l-player f l-static scene ila kan game over
                 if (player) { player.draw(); }
             }
        }
    }
    
    function handleJump(event) {
        if (!game.isRunning) return; // Ma dir walo ila l game ma khdamch
        
        // Handle Spacebar (always allows single press jump)
        if (event.type === 'keydown') {
             if (event.code !== 'Space') return;
             event.preventDefault(); 
             player.jump();
             return;
        }
        
        // --- Double Click/Tap Logic for Mouse/Touch ---
        const currentTime = performance.now();
        const timeDiff = currentTime - lastClickTime;
        
        if (timeDiff > 0 && timeDiff < DOUBLE_CLICK_TIME) {
            event.preventDefault(); 
            player.jump();
            lastClickTime = 0; // Reset
        } else {
             lastClickTime = currentTime;
        }
    }

    // Initialize the Game Listeners (only apply when game is active)
    window.addEventListener('resize', resizeCanvas);
    canvas.addEventListener('mousedown', handleJump);
    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleJump(e); });
    document.addEventListener('keydown', handleJump);
    
    // Landing Page Button Listener
    connectButton.addEventListener('click', () => {
        hideAllStatuses();
        connectWallet(connectButton);
    });
    
    // Restart Button Listener (still handles payment for playing)
    restartButton.addEventListener('click', () => {
        // Nsfiw l message qbl ma nbdaw l khlas
        paymentStatusEl.textContent = '';
        paymentStatusEl.className = '';
        paymentStatusEl.style.display = 'none';
        
        payThen(resetGame, restartButton);
    });
    
    // Initial setup on load: Try to connect silently, otherwise show landing page
    loadHighScore();
    
    // 3ayet l resize Canvas w drawStaticLandingScene f l-bedya
    resizeCanvas();
    drawStaticLandingScene(); 
    
    // Try to connect the wallet silently on load (no button reference)
    connectWallet(null);
    
</script>

</body>
</html>
